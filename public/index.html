<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Transcript Extractor</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      max-width: 800px;
      width: 100%;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #5568d3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .loading {
      text-align: center;
      color: #667eea;
      margin: 20px 0;
      display: none;
    }

    .loading.active {
      display: block;
    }

    .error {
      background: #fee;
      border: 1px solid #fcc;
      color: #c33;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      display: none;
    }

    .error.active {
      display: block;
    }

    .transcript-container {
      display: none;
    }

    .transcript-container.active {
      display: block;
    }

    .transcript-header {
      background: #f5f5f5;
      padding: 12px 16px;
      border-radius: 6px 6px 0 0;
      border-bottom: 2px solid #e0e0e0;
      font-weight: 600;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .copy-btn {
      padding: 8px 16px;
      font-size: 13px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .copy-btn:hover {
      background: #5568d3;
    }

    .copy-btn.copied {
      background: #48bb78;
    }

    .copy-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .button-group {
      display: flex;
      gap: 8px;
    }

    .summary-container {
      margin-top: 20px;
      display: none;
    }

    .summary-container.active {
      display: block;
    }

    .summary-header {
      background: #f5f5f5;
      padding: 12px 16px;
      border-radius: 6px 6px 0 0;
      border-bottom: 2px solid #e0e0e0;
      font-weight: 600;
      color: #333;
    }

    .summary-content {
      background: #fafafa;
      padding: 20px;
      border-radius: 0 0 6px 6px;
      max-height: 500px;
      overflow-y: auto;
      line-height: 1.8;
      color: #333;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .summary-content p {
      margin-bottom: 16px;
    }

    .summary-content::-webkit-scrollbar {
      width: 8px;
    }

    .summary-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .summary-content::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    .summary-content::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    .transcript-content {
      background: #fafafa;
      padding: 20px;
      border-radius: 0 0 6px 6px;
      max-height: 400px;
      overflow-y: auto;
      line-height: 1.6;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .transcript-content::-webkit-scrollbar {
      width: 8px;
    }

    .transcript-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .transcript-content::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    .transcript-content::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    [contenteditable="true"]:focus {
      outline: 2px solid #667eea;
      background: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>YouTube Transcript Extractor</h1>
    <p class="subtitle">Paste a YouTube video URL to extract its automated transcript</p>

    <div class="input-group">
      <input
        type="text"
        id="urlInput"
        placeholder="https://www.youtube.com/watch?v=..."
        aria-label="YouTube URL"
      >
      <button id="fetchBtn" onclick="fetchTranscript()">Get Transcript</button>
      <button id="manualBtn" onclick="enableManualInput()" style="background: #48bb78;">Manual Input</button>
    </div>

    <div class="loading" id="loading">
      <p>Fetching transcript...</p>
    </div>

    <div class="error" id="error"></div>

    <div class="transcript-container" id="transcriptContainer">
      <div class="transcript-header">
        <span>Transcript</span>
        <div class="button-group">
          <button class="copy-btn" id="copyBtn" onclick="copyTranscript()">Copy</button>
          <button class="copy-btn" id="summarizeBtn" onclick="summarizeTranscript()">Summarize</button>
          <button class="copy-btn" id="summarizeGeminiBtn" onclick="summarizeTranscriptGemini()">Summarize (Gemini)</button>
        </div>
      </div>
      <div class="transcript-content" id="transcriptContent"></div>
    </div>

    <div class="summary-container" id="summaryContainer">
      <div class="summary-header">
        <span>Summary</span>
      </div>
      <div class="summary-content" id="summaryContent"></div>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const fetchBtn = document.getElementById('fetchBtn');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const transcriptContainer = document.getElementById('transcriptContainer');
    const transcriptContent = document.getElementById('transcriptContent');
    const summaryContainer = document.getElementById('summaryContainer');
    const summaryContent = document.getElementById('summaryContent');
    const summarizeBtn = document.getElementById('summarizeBtn');
    const summarizeGeminiBtn = document.getElementById('summarizeGeminiBtn');

    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        fetchTranscript();
      }
    });

    async function fetchTranscript() {
      const url = urlInput.value.trim();

      if (!url) {
        showError('Please enter a YouTube URL');
        return;
      }

      hideError();
      hideTranscript();
      showLoading();
      fetchBtn.disabled = true;

      try {
        const response = await fetch(`/api/transcript?url=${encodeURIComponent(url)}`);
        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to fetch transcript');
        }

        showTranscript(data.transcript);
      } catch (err) {
        showError(err.message);
      } finally {
        hideLoading();
        fetchBtn.disabled = false;
      }
    }

    function showLoading() {
      loading.classList.add('active');
    }

    function hideLoading() {
      loading.classList.remove('active');
    }

    function showError(message) {
      error.textContent = message;
      error.classList.add('active');
    }

    function hideError() {
      error.classList.remove('active');
    }

    function showTranscript(text) {
      transcriptContent.textContent = text;
      transcriptContainer.classList.add('active');
    }

    function hideTranscript() {
      transcriptContainer.classList.remove('active');
      summaryContainer.classList.remove('active');
    }

    async function copyTranscript() {
      const text = transcriptContent.textContent;
      const copyBtn = document.getElementById('copyBtn');

      try {
        await navigator.clipboard.writeText(text);

        // Show feedback
        copyBtn.textContent = 'Copied!';
        copyBtn.classList.add('copied');

        // Reset after 2 seconds
        setTimeout(() => {
          copyBtn.textContent = 'Copy';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        showError('Failed to copy to clipboard');
      }
    }

    async function summarizeTranscript() {
      const transcript = transcriptContent.textContent;

      if (!transcript) {
        showError('No transcript available to summarize');
        return;
      }

      summarizeBtn.disabled = true;
      summarizeBtn.textContent = 'Summarizing...';
      hideError();

      try {
        const response = await fetch('/api/summarize', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ transcript })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to generate summary');
        }

        displaySummary(data.summary);

      } catch (err) {
        showError('Summarization failed: ' + err.message);
      } finally {
        summarizeBtn.disabled = false;
        summarizeBtn.textContent = 'Summarize';
      }
    }

    async function summarizeTranscriptGemini() {
      const transcript = transcriptContent.textContent;

      if (!transcript) {
        showError('No transcript available to summarize');
        return;
      }

      summarizeGeminiBtn.disabled = true;
      summarizeGeminiBtn.textContent = 'Summarizing (Gemini)...';
      hideError();

      try {
        const response = await fetch('/api/summarize-gemini', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ transcript })
        });

        let data;
        try {
          data = await response.json();
        } catch (e) {
          // If JSON parse fails, use status text
          if (!response.ok) {
            throw new Error(`Server error: ${response.status} ${response.statusText}`);
          }
        }

        if (!response.ok) {
          throw new Error(data?.error || `Failed to generate summary (${response.status})`);
        }

        displaySummary(data.summary);

      } catch (err) {
        showError('Gemini Summarization failed: ' + err.message);
      } finally {
        summarizeGeminiBtn.disabled = false;
        summarizeGeminiBtn.textContent = 'Summarize (Gemini)';
      }
    }

    function displaySummary(summaryText) {
      // Split text by double newlines to create paragraphs
      const paragraphs = summaryText.split(/\n\n+/).filter(p => p.trim().length > 0);

      // Wrap each paragraph in <p> tags
      const formattedHTML = paragraphs.map(p => `<p>${p.trim()}</p>`).join('');

      summaryContent.innerHTML = formattedHTML;
      summaryContainer.classList.add('active');
    }

    function enableManualInput() {
      // Reset UI
      hideError();
      hideLoading();
      
      // Reset and show transcript container
      transcriptContent.textContent = '';
      transcriptContainer.classList.add('active');
      summaryContainer.classList.remove('active');
      
      // Make editable
      transcriptContent.contentEditable = "true";
      transcriptContent.focus();
      
      // Add a temporary placeholder effect if empty
      transcriptContent.setAttribute('placeholder', 'Paste your transcript here...');
    }

    // Ensure fetching disables edit mode
    const originalShowTranscript = showTranscript;
    showTranscript = function(text) {
      transcriptContent.contentEditable = "false";
      originalShowTranscript(text);
    }
  </script>
</body>
</html>
